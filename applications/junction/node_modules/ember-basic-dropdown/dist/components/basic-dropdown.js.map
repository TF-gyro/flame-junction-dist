{"version":3,"file":"basic-dropdown.js","sources":["../../src/components/basic-dropdown.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport { scheduleTask } from 'ember-lifeline';\nimport calculatePosition from '../utils/calculate-position.ts';\nimport type {\n  CalculatePosition,\n  CalculatePositionResult,\n  HorizontalPosition,\n  VerticalPosition,\n} from '../utils/calculate-position.ts';\nimport { getOwner } from '@ember/application';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type { BasicDropdownTriggerSignature } from './basic-dropdown-trigger.ts';\nimport type { BasicDropdownContentSignature } from './basic-dropdown-content.ts';\n\nexport interface DropdownActions {\n  toggle: (e?: Event) => void;\n  close: (e?: Event, skipFocus?: boolean) => void;\n  open: (e?: Event) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  reposition: (...args: any[]) => undefined | RepositionChanges;\n  registerTriggerElement: (e: HTMLElement) => void;\n  registerDropdownElement: (e: HTMLElement) => void;\n  getTriggerElement: () => HTMLElement | null;\n}\n\nexport interface Dropdown {\n  uniqueId: string;\n  disabled: boolean;\n  isOpen: boolean;\n  actions: DropdownActions;\n}\n\nexport type TRootEventType = 'click' | 'mousedown';\n\nconst UNINITIALIZED = {};\nconst IGNORED_STYLES = ['top', 'left', 'right', 'width', 'height'];\n\nexport interface BasicDropdownDefaultBlock {\n  uniqueId: string;\n  disabled: boolean;\n  isOpen: boolean;\n  actions: DropdownActions;\n  Trigger: ComponentLike<BasicDropdownTriggerSignature>;\n  Content: ComponentLike<BasicDropdownContentSignature>;\n}\n\nexport interface BasicDropdownSignature {\n  Element: HTMLElement;\n  Args: BasicDropdownArgs;\n  Blocks: {\n    default: [BasicDropdownDefaultBlock];\n  };\n}\n\nexport interface BasicDropdownArgs {\n  initiallyOpened?: boolean;\n  renderInPlace?: boolean;\n  verticalPosition?: VerticalPosition;\n  horizontalPosition?: HorizontalPosition;\n  destination?: string;\n  destinationElement?: HTMLElement;\n  disabled?: boolean;\n  dropdownId?: string;\n  rootEventType?: TRootEventType;\n  preventScroll?: boolean;\n  matchTriggerWidth?: boolean;\n  onInit?: (dropdown: Dropdown) => void;\n  registerAPI?: (dropdown: Dropdown | null) => void;\n  onOpen?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  onClose?: (dropdown: Dropdown, e?: Event) => boolean | void;\n  triggerComponent?:\n    | string\n    | ComponentLike<BasicDropdownTriggerSignature>\n    | undefined;\n  contentComponent?:\n    | string\n    | ComponentLike<BasicDropdownContentSignature>\n    | undefined;\n  calculatePosition?: CalculatePosition;\n}\n\ntype RepositionChanges = {\n  hPosition: HorizontalPosition;\n  vPosition: VerticalPosition;\n  otherStyles: Record<string, string | number | undefined>;\n  top?: string | undefined;\n  left?: string | undefined;\n  right?: string | undefined;\n  width?: string | undefined;\n  height?: string | undefined;\n};\n\nexport default class BasicDropdown extends Component<BasicDropdownSignature> {\n  @tracked hPosition: HorizontalPosition | null = null;\n  @tracked vPosition: VerticalPosition | null = null;\n  @tracked top: string | undefined;\n  @tracked left: string | undefined;\n  @tracked right: string | undefined;\n  @tracked width: string | undefined;\n  @tracked height: string | undefined;\n  @tracked otherStyles: Record<string, string | number | undefined> = {};\n  @tracked isOpen = this.args.initiallyOpened || false;\n  @tracked renderInPlace =\n    this.args.renderInPlace !== undefined ? this.args.renderInPlace : false;\n  private previousVerticalPosition?: VerticalPosition | undefined;\n  private previousHorizontalPosition?: HorizontalPosition | undefined;\n  private triggerElement: HTMLElement | null = null;\n  private dropdownElement: HTMLElement | null = null;\n\n  private _uid = guidFor(this);\n  private _dropdownId: string =\n    this.args.dropdownId || `ember-basic-dropdown-content-${this._uid}`;\n  private _previousDisabled = UNINITIALIZED;\n  private _actions: DropdownActions = {\n    open: this.open.bind(this),\n    close: this.close.bind(this),\n    toggle: this.toggle.bind(this),\n    reposition: this.reposition.bind(this),\n    registerTriggerElement: this.registerTriggerElement.bind(this),\n    registerDropdownElement: this.registerDropdownElement.bind(this),\n    getTriggerElement: () => this.triggerElement,\n  };\n\n  private get horizontalPosition() {\n    return this.args.horizontalPosition || 'auto'; // auto-right | right | center | left\n  }\n\n  private get verticalPosition() {\n    return this.args.verticalPosition || 'auto'; // above | below\n  }\n\n  get destination(): string {\n    return this.args.destination || this._getDestinationId();\n  }\n\n  get destinationElement(): HTMLElement | null {\n    if (this.args.destinationElement) {\n      return this.args.destinationElement;\n    }\n\n    const element = document.getElementById(this.destination);\n\n    if (element) {\n      return element;\n    }\n\n    if (\n      this.triggerElement &&\n      this.triggerElement.getRootNode() instanceof ShadowRoot\n    ) {\n      return (this.triggerElement.getRootNode() as HTMLElement)?.querySelector(\n        `#${this.destination}`,\n      );\n    }\n\n    return null;\n  }\n\n  get disabled(): boolean {\n    const newVal = this.args.disabled || false;\n    if (\n      this._previousDisabled !== UNINITIALIZED &&\n      this._previousDisabled !== newVal\n    ) {\n      scheduleTask(this, 'actions', () => {\n        if (newVal && this.publicAPI.isOpen) {\n          // eslint-disable-next-line ember/no-side-effects\n          this.isOpen = false;\n        }\n        if (this.args.registerAPI) {\n          this.args.registerAPI(this.publicAPI);\n        }\n      });\n    }\n    // eslint-disable-next-line ember/no-side-effects\n    this._previousDisabled = newVal;\n    return newVal;\n  }\n\n  get publicAPI(): Dropdown {\n    return {\n      uniqueId: this._uid,\n      isOpen: this.isOpen,\n      disabled: this.disabled,\n      actions: this._actions,\n    };\n  }\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: BasicDropdownArgs) {\n    super(owner, args);\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n  }\n\n  override willDestroy(): void {\n    super.willDestroy();\n    if (this.args.registerAPI) {\n      this.args.registerAPI(null);\n    }\n  }\n\n  // Actions\n  @action\n  open(e?: Event): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onOpen && this.args.onOpen(this.publicAPI, e) === false) {\n      return;\n    }\n    this.isOpen = true;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (trigger) {\n      const parent = trigger.parentElement;\n      if (parent) {\n        parent.setAttribute('aria-owns', this._dropdownId);\n      }\n    }\n  }\n\n  @action\n  close(e?: Event, skipFocus?: boolean): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || !this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onClose && this.args.onClose(this.publicAPI, e) === false) {\n      return;\n    }\n    if (this.isDestroyed) {\n      return; // To check that the `onClose` didn't destroy the dropdown\n    }\n    this.hPosition = this.vPosition = null;\n    this.top = this.left = this.right = this.width = this.height = undefined;\n    this.previousVerticalPosition = this.previousHorizontalPosition = undefined;\n    this.isOpen = false;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (!trigger) {\n      return;\n    }\n    const parent = trigger.parentElement;\n    if (parent) {\n      parent.removeAttribute('aria-owns');\n    }\n    if (skipFocus) {\n      return;\n    }\n    if (trigger.tabIndex > -1) {\n      trigger.focus();\n    }\n  }\n\n  @action\n  toggle(e?: Event): void {\n    if (this.publicAPI.isOpen) {\n      this.close(e);\n    } else {\n      this.open(e);\n    }\n  }\n\n  @action\n  reposition(): undefined | RepositionChanges {\n    if (!this.publicAPI.isOpen) {\n      return;\n    }\n    const dropdownElement = this._getDropdownElement();\n    const triggerElement = this._getTriggerElement();\n    if (!dropdownElement || !triggerElement || !this.destinationElement) {\n      return;\n    }\n\n    const {\n      horizontalPosition,\n      verticalPosition,\n      previousHorizontalPosition,\n      previousVerticalPosition,\n    } = this;\n    const { renderInPlace = false, matchTriggerWidth = false } = this.args;\n    const calculatePositionFn =\n      this.args.calculatePosition || calculatePosition;\n    const positionData = calculatePositionFn(\n      triggerElement,\n      dropdownElement,\n      this.destinationElement,\n      {\n        horizontalPosition,\n        verticalPosition,\n        previousHorizontalPosition,\n        previousVerticalPosition,\n        renderInPlace,\n        matchTriggerWidth,\n        dropdown: this,\n      },\n    );\n    return this.applyReposition(triggerElement, dropdownElement, positionData);\n  }\n\n  @action\n  registerTriggerElement(element: HTMLElement): void {\n    this.triggerElement = element;\n  }\n\n  @action\n  registerDropdownElement(element: HTMLElement): void {\n    this.dropdownElement = element;\n  }\n\n  applyReposition(\n    _trigger: Element,\n    dropdown: HTMLElement,\n    positions: CalculatePositionResult,\n  ): RepositionChanges {\n    const changes: RepositionChanges = {\n      hPosition: positions.horizontalPosition,\n      vPosition: positions.verticalPosition,\n      otherStyles: Object.assign({}, this.otherStyles),\n    };\n\n    if (positions.style) {\n      if (positions.style.top !== undefined) {\n        changes.top = `${positions.style.top}px`;\n      }\n      // The component can be aligned from the right or from the left, but not from both.\n      if (positions.style.left !== undefined) {\n        changes.left = `${positions.style.left}px`;\n        changes.right = undefined;\n        // Since we set the first run manually we may need to unset the `right` property.\n        if (positions.style.right !== undefined) {\n          positions.style.right = undefined;\n        }\n      } else if (positions.style.right !== undefined) {\n        changes.right = `${positions.style.right}px`;\n        changes.left = undefined;\n      }\n      if (positions.style.width !== undefined) {\n        changes.width = `${positions.style.width}px`;\n      }\n      if (positions.style.height !== undefined) {\n        changes.height = `${positions.style.height}px`;\n      }\n      if (this.top === undefined) {\n        // Bypass Ember on the first reposition only to avoid flickering.\n        for (const prop in positions.style) {\n          if (positions.style[prop] !== undefined) {\n            if (typeof positions.style[prop] === 'number') {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}px`);\n            } else {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}`);\n            }\n          }\n        }\n      }\n    }\n    for (const prop in positions.style) {\n      if (!IGNORED_STYLES.includes(prop)) {\n        changes.otherStyles[prop] = positions.style[prop];\n      }\n    }\n\n    this.hPosition = changes.hPosition;\n    this.vPosition = changes.vPosition;\n    this.top = changes.top;\n    this.left = changes.left;\n    this.right = changes.right;\n    this.width = changes.width;\n    this.height = changes.height;\n    this.otherStyles = changes.otherStyles;\n    this.previousHorizontalPosition = positions.horizontalPosition;\n    this.previousVerticalPosition = positions.verticalPosition;\n    return changes;\n  }\n\n  _getDestinationId(): string {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    const config = getOwner(this).resolveRegistration('config:environment') as {\n      environment: string;\n      APP: {\n        rootElement: string;\n      };\n      'ember-basic-dropdown': {\n        destination: string;\n      };\n    };\n\n    if (config.environment === 'test') {\n      // document doesn't exist in fastboot apps, for this reason we need this check\n      if (typeof document === 'undefined') {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // check if destination exists in tests:\n      if (\n        config['ember-basic-dropdown'] &&\n        config['ember-basic-dropdown'].destination\n      ) {\n        const destination = config['ember-basic-dropdown'].destination;\n        if (document.getElementById(destination) !== null) {\n          return destination;\n        }\n      }\n\n      // check if default element exists in tests:\n      if (document.getElementById('ember-basic-dropdown-wormhole') !== null) {\n        return 'ember-basic-dropdown-wormhole';\n      }\n\n      // fall back to rootElement as destination\n      const rootElement = config['APP']?.rootElement;\n      return (\n        document.querySelector(rootElement)?.id ??\n        'ember-basic-dropdown-wormhole'\n      );\n    }\n\n    return (\n      (config['ember-basic-dropdown'] &&\n        config['ember-basic-dropdown'].destination) ||\n      'ember-basic-dropdown-wormhole'\n    );\n  }\n\n  _getDropdownElement(): HTMLElement | null {\n    if (this.dropdownElement) {\n      return this.dropdownElement;\n    }\n\n    return document.querySelector(`[id=\"${this._dropdownId}\"]`);\n  }\n\n  _getTriggerElement(): HTMLElement | null {\n    if (this.triggerElement) {\n      return this.triggerElement;\n    }\n\n    return document.querySelector(\n      `[data-ebd-id=${this.publicAPI.uniqueId}-trigger]`,\n    );\n  }\n}\n"],"names":["UNINITIALIZED","IGNORED_STYLES","BasicDropdown","Component","g","prototype","tracked","i","void 0","args","initiallyOpened","renderInPlace","undefined","previousVerticalPosition","previousHorizontalPosition","triggerElement","dropdownElement","_uid","guidFor","_dropdownId","dropdownId","_previousDisabled","_actions","open","bind","close","toggle","reposition","registerTriggerElement","registerDropdownElement","getTriggerElement","horizontalPosition","verticalPosition","destination","_getDestinationId","destinationElement","element","document","getElementById","getRootNode","ShadowRoot","querySelector","disabled","newVal","scheduleTask","publicAPI","isOpen","registerAPI","uniqueId","actions","constructor","owner","onInit","willDestroy","e","isDestroyed","onOpen","trigger","_getTriggerElement","parent","parentElement","setAttribute","n","action","skipFocus","onClose","hPosition","vPosition","top","left","right","width","height","removeAttribute","tabIndex","focus","_getDropdownElement","matchTriggerWidth","calculatePositionFn","calculatePosition","positionData","dropdown","applyReposition","_trigger","positions","changes","otherStyles","Object","assign","style","prop","setProperty","includes","config","getOwner","resolveRegistration","environment","rootElement","id","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;;AAsCA,MAAMA,aAAa,GAAG,EAAE;AACxB,MAAMC,cAAc,GAAG,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,CAAC;AAyDnD,MAAMC,aAAa,SAASC,SAAS,CAAyB;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,WAAA,EAAA,CAC1EC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAAwC,IAAI;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,UAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,WAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,WAAA,EAAA,CACnDC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAAsC,IAAI;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,UAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,WAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,KAAA,EAAA,CACjDC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,IAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,KAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,MAAA,EAAA,CACPC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,KAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,MAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,OAAA,EAAA,CACPC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,MAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,OAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,OAAA,EAAA,CACPC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,MAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,OAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,QAAA,EAAA,CACPC,OAAO,CAAA,CAAA;AAAA;AAAA,EAAA,OAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,QAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,aAAA,EAAA,CACPC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAA4D,EAAE;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,YAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,aAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,QAAA,EAAA,CACrEC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OAAU,IAAI,CAACG,IAAI,CAACC,eAAe,IAAI,KAAK;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,OAAA,IAAAH,CAAA,CAAA,IAAA,EAAA,QAAA,CAAA,EAAAC,SAAA;AAAA,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,eAAA,EAAA,CACnDC,OAAO,CAAA,EAAA,YAAA;AAAA,MAAA,OACN,IAAI,CAACG,IAAI,CAACE,aAAa,KAAKC,SAAS,GAAG,IAAI,CAACH,IAAI,CAACE,aAAa,GAAG,KAAK;AAAA,KAAA,CAAA;AAAA;AAAA,EAAA,cAAA,IAAAJ,CAAA,CAAA,IAAA,EAAA,eAAA,CAAA,EAAAC,SAAA;EACjEK,wBAAwB;EACxBC,0BAA0B;AAC1BC,EAAAA,cAAc,GAAuB,IAAI;AACzCC,EAAAA,eAAe,GAAuB,IAAI;AAE1CC,EAAAA,IAAI,GAAGC,OAAO,CAAC,IAAI,CAAC;EACpBC,WAAW,GACjB,IAAI,CAACV,IAAI,CAACW,UAAU,IAAI,CAAgC,6BAAA,EAAA,IAAI,CAACH,IAAI,CAAE,CAAA;AAC7DI,EAAAA,iBAAiB,GAAGrB,aAAa;AACjCsB,EAAAA,QAAQ,GAAoB;IAClCC,IAAI,EAAE,IAAI,CAACA,IAAI,CAACC,IAAI,CAAC,IAAI,CAAC;IAC1BC,KAAK,EAAE,IAAI,CAACA,KAAK,CAACD,IAAI,CAAC,IAAI,CAAC;IAC5BE,MAAM,EAAE,IAAI,CAACA,MAAM,CAACF,IAAI,CAAC,IAAI,CAAC;IAC9BG,UAAU,EAAE,IAAI,CAACA,UAAU,CAACH,IAAI,CAAC,IAAI,CAAC;IACtCI,sBAAsB,EAAE,IAAI,CAACA,sBAAsB,CAACJ,IAAI,CAAC,IAAI,CAAC;IAC9DK,uBAAuB,EAAE,IAAI,CAACA,uBAAuB,CAACL,IAAI,CAAC,IAAI,CAAC;AAChEM,IAAAA,iBAAiB,EAAEA,MAAM,IAAI,CAACf;GAC/B;EAED,IAAYgB,kBAAkBA,GAAG;IAC/B,OAAO,IAAI,CAACtB,IAAI,CAACsB,kBAAkB,IAAI,MAAM,CAAC;AAChD;EAEA,IAAYC,gBAAgBA,GAAG;IAC7B,OAAO,IAAI,CAACvB,IAAI,CAACuB,gBAAgB,IAAI,MAAM,CAAC;AAC9C;EAEA,IAAIC,WAAWA,GAAW;IACxB,OAAO,IAAI,CAACxB,IAAI,CAACwB,WAAW,IAAI,IAAI,CAACC,iBAAiB,EAAE;AAC1D;EAEA,IAAIC,kBAAkBA,GAAuB;AAC3C,IAAA,IAAI,IAAI,CAAC1B,IAAI,CAAC0B,kBAAkB,EAAE;AAChC,MAAA,OAAO,IAAI,CAAC1B,IAAI,CAAC0B,kBAAkB;AACrC;IAEA,MAAMC,OAAO,GAAGC,QAAQ,CAACC,cAAc,CAAC,IAAI,CAACL,WAAW,CAAC;AAEzD,IAAA,IAAIG,OAAO,EAAE;AACX,MAAA,OAAOA,OAAO;AAChB;AAEA,IAAA,IACE,IAAI,CAACrB,cAAc,IACnB,IAAI,CAACA,cAAc,CAACwB,WAAW,EAAE,YAAYC,UAAU,EACvD;AACA,MAAA,OAAQ,IAAI,CAACzB,cAAc,CAACwB,WAAW,EAAE,EAAkBE,aAAa,CACtE,CAAI,CAAA,EAAA,IAAI,CAACR,WAAW,EACtB,CAAC;AACH;AAEA,IAAA,OAAO,IAAI;AACb;EAEA,IAAIS,QAAQA,GAAY;IACtB,MAAMC,MAAM,GAAG,IAAI,CAAClC,IAAI,CAACiC,QAAQ,IAAI,KAAK;IAC1C,IACE,IAAI,CAACrB,iBAAiB,KAAKrB,aAAa,IACxC,IAAI,CAACqB,iBAAiB,KAAKsB,MAAM,EACjC;AACAC,MAAAA,YAAY,CAAC,IAAI,EAAE,SAAS,EAAE,MAAM;AAClC,QAAA,IAAID,MAAM,IAAI,IAAI,CAACE,SAAS,CAACC,MAAM,EAAE;AACnC;UACA,IAAI,CAACA,MAAM,GAAG,KAAK;AACrB;AACA,QAAA,IAAI,IAAI,CAACrC,IAAI,CAACsC,WAAW,EAAE;UACzB,IAAI,CAACtC,IAAI,CAACsC,WAAW,CAAC,IAAI,CAACF,SAAS,CAAC;AACvC;AACF,OAAC,CAAC;AACJ;AACA;IACA,IAAI,CAACxB,iBAAiB,GAAGsB,MAAM;AAC/B,IAAA,OAAOA,MAAM;AACf;EAEA,IAAIE,SAASA,GAAa;IACxB,OAAO;MACLG,QAAQ,EAAE,IAAI,CAAC/B,IAAI;MACnB6B,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBJ,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBO,OAAO,EAAE,IAAI,CAAC3B;KACf;AACH;;AAEA;AACA4B,EAAAA,WAAWA,CAACC,KAAY,EAAE1C,IAAuB,EAAE;AACjD,IAAA,KAAK,CAAC0C,KAAK,EAAE1C,IAAI,CAAC;AAClB,IAAA,IAAI,IAAI,CAACA,IAAI,CAAC2C,MAAM,EAAE;MACpB,IAAI,CAAC3C,IAAI,CAAC2C,MAAM,CAAC,IAAI,CAACP,SAAS,CAAC;AAClC;AACA,IAAA,IAAI,IAAI,CAACpC,IAAI,CAACsC,WAAW,EAAE;MACzB,IAAI,CAACtC,IAAI,CAACsC,WAAW,CAAC,IAAI,CAACF,SAAS,CAAC;AACvC;AACF;AAESQ,EAAAA,WAAWA,GAAS;IAC3B,KAAK,CAACA,WAAW,EAAE;AACnB,IAAA,IAAI,IAAI,CAAC5C,IAAI,CAACsC,WAAW,EAAE;AACzB,MAAA,IAAI,CAACtC,IAAI,CAACsC,WAAW,CAAC,IAAI,CAAC;AAC7B;AACF;;AAEA;EAEAxB,IAAIA,CAAC+B,CAAS,EAAQ;IACpB,IAAI,IAAI,CAACC,WAAW,EAAE;AACpB,MAAA;AACF;IACA,IAAI,IAAI,CAACV,SAAS,CAACH,QAAQ,IAAI,IAAI,CAACG,SAAS,CAACC,MAAM,EAAE;AACpD,MAAA;AACF;IACA,IAAI,IAAI,CAACrC,IAAI,CAAC+C,MAAM,IAAI,IAAI,CAAC/C,IAAI,CAAC+C,MAAM,CAAC,IAAI,CAACX,SAAS,EAAES,CAAC,CAAC,KAAK,KAAK,EAAE;AACrE,MAAA;AACF;IACA,IAAI,CAACR,MAAM,GAAG,IAAI;AAClB,IAAA,IAAI,IAAI,CAACrC,IAAI,CAACsC,WAAW,EAAE;MACzB,IAAI,CAACtC,IAAI,CAACsC,WAAW,CAAC,IAAI,CAACF,SAAS,CAAC;AACvC;AACA,IAAA,MAAMY,OAAO,GAAG,IAAI,CAACC,kBAAkB,EAAE;AACzC,IAAA,IAAID,OAAO,EAAE;AACX,MAAA,MAAME,MAAM,GAAGF,OAAO,CAACG,aAAa;AACpC,MAAA,IAAID,MAAM,EAAE;QACVA,MAAM,CAACE,YAAY,CAAC,WAAW,EAAE,IAAI,CAAC1C,WAAW,CAAC;AACpD;AACF;AACF;AAAC,EAAA;IAAA2C,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,MAAA,EAAA,CAtBA0D,MAAM,CAAA,CAAA;AAAA;AAyBPtC,EAAAA,KAAKA,CAAC6B,CAAS,EAAEU,SAAmB,EAAQ;IAC1C,IAAI,IAAI,CAACT,WAAW,EAAE;AACpB,MAAA;AACF;AACA,IAAA,IAAI,IAAI,CAACV,SAAS,CAACH,QAAQ,IAAI,CAAC,IAAI,CAACG,SAAS,CAACC,MAAM,EAAE;AACrD,MAAA;AACF;IACA,IAAI,IAAI,CAACrC,IAAI,CAACwD,OAAO,IAAI,IAAI,CAACxD,IAAI,CAACwD,OAAO,CAAC,IAAI,CAACpB,SAAS,EAAES,CAAC,CAAC,KAAK,KAAK,EAAE;AACvE,MAAA;AACF;IACA,IAAI,IAAI,CAACC,WAAW,EAAE;AACpB,MAAA,OAAO;AACT;AACA,IAAA,IAAI,CAACW,SAAS,GAAG,IAAI,CAACC,SAAS,GAAG,IAAI;AACtC,IAAA,IAAI,CAACC,GAAG,GAAG,IAAI,CAACC,IAAI,GAAG,IAAI,CAACC,KAAK,GAAG,IAAI,CAACC,KAAK,GAAG,IAAI,CAACC,MAAM,GAAG5D,SAAS;AACxE,IAAA,IAAI,CAACC,wBAAwB,GAAG,IAAI,CAACC,0BAA0B,GAAGF,SAAS;IAC3E,IAAI,CAACkC,MAAM,GAAG,KAAK;AACnB,IAAA,IAAI,IAAI,CAACrC,IAAI,CAACsC,WAAW,EAAE;MACzB,IAAI,CAACtC,IAAI,CAACsC,WAAW,CAAC,IAAI,CAACF,SAAS,CAAC;AACvC;AACA,IAAA,MAAMY,OAAO,GAAG,IAAI,CAACC,kBAAkB,EAAE;IACzC,IAAI,CAACD,OAAO,EAAE;AACZ,MAAA;AACF;AACA,IAAA,MAAME,MAAM,GAAGF,OAAO,CAACG,aAAa;AACpC,IAAA,IAAID,MAAM,EAAE;AACVA,MAAAA,MAAM,CAACc,eAAe,CAAC,WAAW,CAAC;AACrC;AACA,IAAA,IAAIT,SAAS,EAAE;AACb,MAAA;AACF;AACA,IAAA,IAAIP,OAAO,CAACiB,QAAQ,GAAG,EAAE,EAAE;MACzBjB,OAAO,CAACkB,KAAK,EAAE;AACjB;AACF;AAAC,EAAA;IAAAb,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,OAAA,EAAA,CAnCA0D,MAAM,CAAA,CAAA;AAAA;EAsCPrC,MAAMA,CAAC4B,CAAS,EAAQ;AACtB,IAAA,IAAI,IAAI,CAACT,SAAS,CAACC,MAAM,EAAE;AACzB,MAAA,IAAI,CAACrB,KAAK,CAAC6B,CAAC,CAAC;AACf,KAAC,MAAM;AACL,MAAA,IAAI,CAAC/B,IAAI,CAAC+B,CAAC,CAAC;AACd;AACF;AAAC,EAAA;IAAAQ,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,QAAA,EAAA,CAPA0D,MAAM,CAAA,CAAA;AAAA;AAUPpC,EAAAA,UAAUA,GAAkC;AAC1C,IAAA,IAAI,CAAC,IAAI,CAACkB,SAAS,CAACC,MAAM,EAAE;AAC1B,MAAA;AACF;AACA,IAAA,MAAM9B,eAAe,GAAG,IAAI,CAAC4D,mBAAmB,EAAE;AAClD,IAAA,MAAM7D,cAAc,GAAG,IAAI,CAAC2C,kBAAkB,EAAE;IAChD,IAAI,CAAC1C,eAAe,IAAI,CAACD,cAAc,IAAI,CAAC,IAAI,CAACoB,kBAAkB,EAAE;AACnE,MAAA;AACF;IAEA,MAAM;MACJJ,kBAAkB;MAClBC,gBAAgB;MAChBlB,0BAA0B;AAC1BD,MAAAA;AACF,KAAC,GAAG,IAAI;IACR,MAAM;AAAEF,MAAAA,aAAa,GAAG,KAAK;AAAEkE,MAAAA,iBAAiB,GAAG;KAAO,GAAG,IAAI,CAACpE,IAAI;IACtE,MAAMqE,mBAAmB,GACvB,IAAI,CAACrE,IAAI,CAACsE,iBAAiB,IAAIA,iBAAiB;IAClD,MAAMC,YAAY,GAAGF,mBAAmB,CACtC/D,cAAc,EACdC,eAAe,EACf,IAAI,CAACmB,kBAAkB,EACvB;MACEJ,kBAAkB;MAClBC,gBAAgB;MAChBlB,0BAA0B;MAC1BD,wBAAwB;MACxBF,aAAa;MACbkE,iBAAiB;AACjBI,MAAAA,QAAQ,EAAE;AACZ,KACF,CAAC;IACD,OAAO,IAAI,CAACC,eAAe,CAACnE,cAAc,EAAEC,eAAe,EAAEgE,YAAY,CAAC;AAC5E;AAAC,EAAA;IAAAlB,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,YAAA,EAAA,CAnCA0D,MAAM,CAAA,CAAA;AAAA;EAsCPnC,sBAAsBA,CAACQ,OAAoB,EAAQ;IACjD,IAAI,CAACrB,cAAc,GAAGqB,OAAO;AAC/B;AAAC,EAAA;IAAA0B,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,wBAAA,EAAA,CAHA0D,MAAM,CAAA,CAAA;AAAA;EAMPlC,uBAAuBA,CAACO,OAAoB,EAAQ;IAClD,IAAI,CAACpB,eAAe,GAAGoB,OAAO;AAChC;AAAC,EAAA;IAAA0B,CAAA,CAAA,IAAA,CAAAzD,SAAA,EAAA,yBAAA,EAAA,CAHA0D,MAAM,CAAA,CAAA;AAAA;AAKPmB,EAAAA,eAAeA,CACbC,QAAiB,EACjBF,QAAqB,EACrBG,SAAkC,EACf;AACnB,IAAA,MAAMC,OAA0B,GAAG;MACjCnB,SAAS,EAAEkB,SAAS,CAACrD,kBAAkB;MACvCoC,SAAS,EAAEiB,SAAS,CAACpD,gBAAgB;MACrCsD,WAAW,EAAEC,MAAM,CAACC,MAAM,CAAC,EAAE,EAAE,IAAI,CAACF,WAAW;KAChD;IAED,IAAIF,SAAS,CAACK,KAAK,EAAE;AACnB,MAAA,IAAIL,SAAS,CAACK,KAAK,CAACrB,GAAG,KAAKxD,SAAS,EAAE;QACrCyE,OAAO,CAACjB,GAAG,GAAG,CAAA,EAAGgB,SAAS,CAACK,KAAK,CAACrB,GAAG,CAAI,EAAA,CAAA;AAC1C;AACA;AACA,MAAA,IAAIgB,SAAS,CAACK,KAAK,CAACpB,IAAI,KAAKzD,SAAS,EAAE;QACtCyE,OAAO,CAAChB,IAAI,GAAG,CAAA,EAAGe,SAAS,CAACK,KAAK,CAACpB,IAAI,CAAI,EAAA,CAAA;QAC1CgB,OAAO,CAACf,KAAK,GAAG1D,SAAS;AACzB;AACA,QAAA,IAAIwE,SAAS,CAACK,KAAK,CAACnB,KAAK,KAAK1D,SAAS,EAAE;AACvCwE,UAAAA,SAAS,CAACK,KAAK,CAACnB,KAAK,GAAG1D,SAAS;AACnC;OACD,MAAM,IAAIwE,SAAS,CAACK,KAAK,CAACnB,KAAK,KAAK1D,SAAS,EAAE;QAC9CyE,OAAO,CAACf,KAAK,GAAG,CAAA,EAAGc,SAAS,CAACK,KAAK,CAACnB,KAAK,CAAI,EAAA,CAAA;QAC5Ce,OAAO,CAAChB,IAAI,GAAGzD,SAAS;AAC1B;AACA,MAAA,IAAIwE,SAAS,CAACK,KAAK,CAAClB,KAAK,KAAK3D,SAAS,EAAE;QACvCyE,OAAO,CAACd,KAAK,GAAG,CAAA,EAAGa,SAAS,CAACK,KAAK,CAAClB,KAAK,CAAI,EAAA,CAAA;AAC9C;AACA,MAAA,IAAIa,SAAS,CAACK,KAAK,CAACjB,MAAM,KAAK5D,SAAS,EAAE;QACxCyE,OAAO,CAACb,MAAM,GAAG,CAAA,EAAGY,SAAS,CAACK,KAAK,CAACjB,MAAM,CAAI,EAAA,CAAA;AAChD;AACA,MAAA,IAAI,IAAI,CAACJ,GAAG,KAAKxD,SAAS,EAAE;AAC1B;AACA,QAAA,KAAK,MAAM8E,IAAI,IAAIN,SAAS,CAACK,KAAK,EAAE;UAClC,IAAIL,SAAS,CAACK,KAAK,CAACC,IAAI,CAAC,KAAK9E,SAAS,EAAE;YACvC,IAAI,OAAOwE,SAAS,CAACK,KAAK,CAACC,IAAI,CAAC,KAAK,QAAQ,EAAE;AAC7CT,cAAAA,QAAQ,CAACQ,KAAK,CAACE,WAAW,CAACD,IAAI,EAAE,CAAGN,EAAAA,SAAS,CAACK,KAAK,CAACC,IAAI,CAAC,IAAI,CAAC;AAChE,aAAC,MAAM;AACLT,cAAAA,QAAQ,CAACQ,KAAK,CAACE,WAAW,CAACD,IAAI,EAAE,CAAGN,EAAAA,SAAS,CAACK,KAAK,CAACC,IAAI,CAAC,EAAE,CAAC;AAC9D;AACF;AACF;AACF;AACF;AACA,IAAA,KAAK,MAAMA,IAAI,IAAIN,SAAS,CAACK,KAAK,EAAE;AAClC,MAAA,IAAI,CAACxF,cAAc,CAAC2F,QAAQ,CAACF,IAAI,CAAC,EAAE;QAClCL,OAAO,CAACC,WAAW,CAACI,IAAI,CAAC,GAAGN,SAAS,CAACK,KAAK,CAACC,IAAI,CAAC;AACnD;AACF;AAEA,IAAA,IAAI,CAACxB,SAAS,GAAGmB,OAAO,CAACnB,SAAS;AAClC,IAAA,IAAI,CAACC,SAAS,GAAGkB,OAAO,CAAClB,SAAS;AAClC,IAAA,IAAI,CAACC,GAAG,GAAGiB,OAAO,CAACjB,GAAG;AACtB,IAAA,IAAI,CAACC,IAAI,GAAGgB,OAAO,CAAChB,IAAI;AACxB,IAAA,IAAI,CAACC,KAAK,GAAGe,OAAO,CAACf,KAAK;AAC1B,IAAA,IAAI,CAACC,KAAK,GAAGc,OAAO,CAACd,KAAK;AAC1B,IAAA,IAAI,CAACC,MAAM,GAAGa,OAAO,CAACb,MAAM;AAC5B,IAAA,IAAI,CAACc,WAAW,GAAGD,OAAO,CAACC,WAAW;AACtC,IAAA,IAAI,CAACxE,0BAA0B,GAAGsE,SAAS,CAACrD,kBAAkB;AAC9D,IAAA,IAAI,CAAClB,wBAAwB,GAAGuE,SAAS,CAACpD,gBAAgB;AAC1D,IAAA,OAAOqD,OAAO;AAChB;AAEAnD,EAAAA,iBAAiBA,GAAW;AAC1B;AACA;AACA;IACA,MAAM2D,MAAM,GAAGC,QAAQ,CAAC,IAAI,CAAC,CAACC,mBAAmB,CAAC,oBAAoB,CAQrE;AAED,IAAA,IAAIF,MAAM,CAACG,WAAW,KAAK,MAAM,EAAE;AACjC;AACA,MAAA,IAAI,OAAO3D,QAAQ,KAAK,WAAW,EAAE;AACnC,QAAA,OAAO,+BAA+B;AACxC;;AAEA;MACA,IACEwD,MAAM,CAAC,sBAAsB,CAAC,IAC9BA,MAAM,CAAC,sBAAsB,CAAC,CAAC5D,WAAW,EAC1C;AACA,QAAA,MAAMA,WAAW,GAAG4D,MAAM,CAAC,sBAAsB,CAAC,CAAC5D,WAAW;QAC9D,IAAII,QAAQ,CAACC,cAAc,CAACL,WAAW,CAAC,KAAK,IAAI,EAAE;AACjD,UAAA,OAAOA,WAAW;AACpB;AACF;;AAEA;MACA,IAAII,QAAQ,CAACC,cAAc,CAAC,+BAA+B,CAAC,KAAK,IAAI,EAAE;AACrE,QAAA,OAAO,+BAA+B;AACxC;;AAEA;AACA,MAAA,MAAM2D,WAAW,GAAGJ,MAAM,CAAC,KAAK,CAAC,EAAEI,WAAW;MAC9C,OACE5D,QAAQ,CAACI,aAAa,CAACwD,WAAW,CAAC,EAAEC,EAAE,IACvC,+BAA+B;AAEnC;AAEA,IAAA,OACGL,MAAM,CAAC,sBAAsB,CAAC,IAC7BA,MAAM,CAAC,sBAAsB,CAAC,CAAC5D,WAAW,IAC5C,+BAA+B;AAEnC;AAEA2C,EAAAA,mBAAmBA,GAAuB;IACxC,IAAI,IAAI,CAAC5D,eAAe,EAAE;MACxB,OAAO,IAAI,CAACA,eAAe;AAC7B;IAEA,OAAOqB,QAAQ,CAACI,aAAa,CAAC,QAAQ,IAAI,CAACtB,WAAW,CAAA,EAAA,CAAI,CAAC;AAC7D;AAEAuC,EAAAA,kBAAkBA,GAAuB;IACvC,IAAI,IAAI,CAAC3C,cAAc,EAAE;MACvB,OAAO,IAAI,CAACA,cAAc;AAC5B;IAEA,OAAOsB,QAAQ,CAACI,aAAa,CAC3B,CAAA,aAAA,EAAgB,IAAI,CAACI,SAAS,CAACG,QAAQ,CAAA,SAAA,CACzC,CAAC;AACH;AACF;AAACmD,oBAAA,CAAAC,QAAA,EA7WoBlG,aAAa,CAAA;;;;"}